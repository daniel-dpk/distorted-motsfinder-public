<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOTS Finder: LockFile Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle_tweaks.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOTS Finder
   </div>
   <div id="projectbrief">Find non-star-shaped MOTSs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">LockFile Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Locking class used as a context manager.  
 <a href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad2e9e52a76ef5007ffc0bc32248a94b2"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#ad2e9e52a76ef5007ffc0bc32248a94b2">__init__</a> (self, fname, lockduration=10, verbosity=0)</td></tr>
<tr class="memdesc:ad2e9e52a76ef5007ffc0bc32248a94b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a lock object.  <a href="#ad2e9e52a76ef5007ffc0bc32248a94b2">More...</a><br /></td></tr>
<tr class="separator:ad2e9e52a76ef5007ffc0bc32248a94b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ec94fef2a7020d648307bd8551a3dea"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a0ec94fef2a7020d648307bd8551a3dea">uniquefile</a> (self)</td></tr>
<tr class="memdesc:a0ec94fef2a7020d648307bd8551a3dea"><td class="mdescLeft">&#160;</td><td class="mdescRight">The unique file used as second link target.  <a href="#a0ec94fef2a7020d648307bd8551a3dea">More...</a><br /></td></tr>
<tr class="separator:a0ec94fef2a7020d648307bd8551a3dea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67847eb889791fe0e423c3d3c85bae6a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a67847eb889791fe0e423c3d3c85bae6a">lockfile</a> (self)</td></tr>
<tr class="memdesc:a67847eb889791fe0e423c3d3c85bae6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The file used as primary link target.  <a href="#a67847eb889791fe0e423c3d3c85bae6a">More...</a><br /></td></tr>
<tr class="separator:a67847eb889791fe0e423c3d3c85bae6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a404692262c90487a8013dbdd128cdd7f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a404692262c90487a8013dbdd128cdd7f">__enter__</a> (self)</td></tr>
<tr class="memdesc:a404692262c90487a8013dbdd128cdd7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enter the <code>with</code> context and establish the lock.  <a href="#a404692262c90487a8013dbdd128cdd7f">More...</a><br /></td></tr>
<tr class="separator:a404692262c90487a8013dbdd128cdd7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d4375d5b88ea11310dcd3bfb10ecb97"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a1d4375d5b88ea11310dcd3bfb10ecb97">__exit__</a> (self, exc_type, exc_val, exc_tb)</td></tr>
<tr class="memdesc:a1d4375d5b88ea11310dcd3bfb10ecb97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Exit the <code>with</code> context and remove the lock.  <a href="#a1d4375d5b88ea11310dcd3bfb10ecb97">More...</a><br /></td></tr>
<tr class="separator:a1d4375d5b88ea11310dcd3bfb10ecb97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41a65d7030dd1006b177d0bc24e1a12b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a41a65d7030dd1006b177d0bc24e1a12b">__del__</a> (self)</td></tr>
<tr class="memdesc:a41a65d7030dd1006b177d0bc24e1a12b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called upon object destruction.  <a href="#a41a65d7030dd1006b177d0bc24e1a12b">More...</a><br /></td></tr>
<tr class="separator:a41a65d7030dd1006b177d0bc24e1a12b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d548c8fa4d88f1f332f2eb6efe17593"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a1d548c8fa4d88f1f332f2eb6efe17593">is_locked</a> (self)</td></tr>
<tr class="memdesc:a1d548c8fa4d88f1f332f2eb6efe17593"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find out if we currently have the lock.  <a href="#a1d548c8fa4d88f1f332f2eb6efe17593">More...</a><br /></td></tr>
<tr class="separator:a1d548c8fa4d88f1f332f2eb6efe17593"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a35777b44c6ed1220e0d6e19cb03c607c"><td class="memItemLeft" align="right" valign="top"><a id="a35777b44c6ed1220e0d6e19cb03c607c"></a>
tuple&#160;</td><td class="memItemRight" valign="bottom"><b>NOT_EXIST_ERRORS</b> = (errno.ESTALE, errno.ENOENT)</td></tr>
<tr class="separator:a35777b44c6ed1220e0d6e19cb03c607c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aa6a0568822c98af51b64cc0898780df6"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#aa6a0568822c98af51b64cc0898780df6">_lock</a> (self)</td></tr>
<tr class="memdesc:aa6a0568822c98af51b64cc0898780df6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire the lock.  <a href="#aa6a0568822c98af51b64cc0898780df6">More...</a><br /></td></tr>
<tr class="separator:aa6a0568822c98af51b64cc0898780df6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3656d3ef8e070ec2c4ef9e3424ff9ffb"><td class="memItemLeft" align="right" valign="top"><a id="a3656d3ef8e070ec2c4ef9e3424ff9ffb"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a3656d3ef8e070ec2c4ef9e3424ff9ffb">_count_links</a> (self)</td></tr>
<tr class="memdesc:a3656d3ef8e070ec2c4ef9e3424ff9ffb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count the number of hard links to our unique file. <br /></td></tr>
<tr class="separator:a3656d3ef8e070ec2c4ef9e3424ff9ffb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a434e1592e020b950702bec7b815a9517"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a434e1592e020b950702bec7b815a9517">_has_expired</a> (self)</td></tr>
<tr class="memdesc:a434e1592e020b950702bec7b815a9517"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the currently active lock has expired.  <a href="#a434e1592e020b950702bec7b815a9517">More...</a><br /></td></tr>
<tr class="separator:a434e1592e020b950702bec7b815a9517"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45c44377b922843390f16be4d2a81a26"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a45c44377b922843390f16be4d2a81a26">_break_foreign_lock</a> (self)</td></tr>
<tr class="memdesc:a45c44377b922843390f16be4d2a81a26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Break a lock of a different process.  <a href="#a45c44377b922843390f16be4d2a81a26">More...</a><br /></td></tr>
<tr class="separator:a45c44377b922843390f16be4d2a81a26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a667d81392a5cc5501fbf762fdde895"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a8a667d81392a5cc5501fbf762fdde895">_is_valid_unique_fname</a> (self, fname)</td></tr>
<tr class="memdesc:a8a667d81392a5cc5501fbf762fdde895"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate that the given filename is a valid "unique" file name.  <a href="#a8a667d81392a5cc5501fbf762fdde895">More...</a><br /></td></tr>
<tr class="separator:a8a667d81392a5cc5501fbf762fdde895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa67ebc9d41a679fa84373d4af6def7cf"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#aa67ebc9d41a679fa84373d4af6def7cf">_read_lockfile</a> (self)</td></tr>
<tr class="memdesc:aa67ebc9d41a679fa84373d4af6def7cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the contents of the current lock file.  <a href="#aa67ebc9d41a679fa84373d4af6def7cf">More...</a><br /></td></tr>
<tr class="separator:aa67ebc9d41a679fa84373d4af6def7cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a968bd6c270043d685c627502321465bb"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a968bd6c270043d685c627502321465bb">_extend_expiration_time</a> (self, fname=None)</td></tr>
<tr class="memdesc:a968bd6c270043d685c627502321465bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the expiration time of the unique file to the future.  <a href="#a968bd6c270043d685c627502321465bb">More...</a><br /></td></tr>
<tr class="separator:a968bd6c270043d685c627502321465bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af04d2136a01425dc9e2bc8c4abfe485f"><td class="memItemLeft" align="right" valign="top"><a id="af04d2136a01425dc9e2bc8c4abfe485f"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#af04d2136a01425dc9e2bc8c4abfe485f">_create_unique_file</a> (self)</td></tr>
<tr class="memdesc:af04d2136a01425dc9e2bc8c4abfe485f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the unique file and set its expiration time. <br /></td></tr>
<tr class="separator:af04d2136a01425dc9e2bc8c4abfe485f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4362e9f882532c0c9c975ad98faf7c04"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a4362e9f882532c0c9c975ad98faf7c04">_remove_unique_file</a> (self)</td></tr>
<tr class="memdesc:a4362e9f882532c0c9c975ad98faf7c04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove our unique file.  <a href="#a4362e9f882532c0c9c975ad98faf7c04">More...</a><br /></td></tr>
<tr class="separator:a4362e9f882532c0c9c975ad98faf7c04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a306aed28634b9b3b76f34d6aff3044ef"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a306aed28634b9b3b76f34d6aff3044ef">_unlock</a> (self)</td></tr>
<tr class="memdesc:a306aed28634b9b3b76f34d6aff3044ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the lock (if any).  <a href="#a306aed28634b9b3b76f34d6aff3044ef">More...</a><br /></td></tr>
<tr class="separator:a306aed28634b9b3b76f34d6aff3044ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9647749a3197d86426a7decc064dd093"><td class="memItemLeft" align="right" valign="top"><a id="a9647749a3197d86426a7decc064dd093"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#a9647749a3197d86426a7decc064dd093">_p</a> (self, args, level=2, kwargs)</td></tr>
<tr class="memdesc:a9647749a3197d86426a7decc064dd093"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print a message depending on its level and our verbosity. <br /></td></tr>
<tr class="separator:a9647749a3197d86426a7decc064dd093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0cc25a5ef891d30ed0cb386db0aa73e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html#aa0cc25a5ef891d30ed0cb386db0aa73e">_unlink</a> (cls, fname)</td></tr>
<tr class="memdesc:aa0cc25a5ef891d30ed0cb386db0aa73e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fault-tolerant file deletion.  <a href="#aa0cc25a5ef891d30ed0cb386db0aa73e">More...</a><br /></td></tr>
<tr class="separator:aa0cc25a5ef891d30ed0cb386db0aa73e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a0e05df927830f884aa2e1e07aa853681"><td class="memItemLeft" align="right" valign="top"><a id="a0e05df927830f884aa2e1e07aa853681"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_verbosity</b></td></tr>
<tr class="separator:a0e05df927830f884aa2e1e07aa853681"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61e53f3213d198710d20688ae3714e6b"><td class="memItemLeft" align="right" valign="top"><a id="a61e53f3213d198710d20688ae3714e6b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_lockduration</b></td></tr>
<tr class="separator:a61e53f3213d198710d20688ae3714e6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eb7590e495dcfab303c2956e6daed64"><td class="memItemLeft" align="right" valign="top"><a id="a4eb7590e495dcfab303c2956e6daed64"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_basedir</b></td></tr>
<tr class="separator:a4eb7590e495dcfab303c2956e6daed64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fdbd670fd2864d2263fa62dce43ef8a"><td class="memItemLeft" align="right" valign="top"><a id="a7fdbd670fd2864d2263fa62dce43ef8a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_lockfilename</b></td></tr>
<tr class="separator:a7fdbd670fd2864d2263fa62dce43ef8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5776106dfd818de45f351bee62e3e54f"><td class="memItemLeft" align="right" valign="top"><a id="a5776106dfd818de45f351bee62e3e54f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_uniquename</b></td></tr>
<tr class="separator:a5776106dfd818de45f351bee62e3e54f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d6b35953984e8e7304068308e0eb3e8"><td class="memItemLeft" align="right" valign="top"><a id="a1d6b35953984e8e7304068308e0eb3e8"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_uniquefile_created</b></td></tr>
<tr class="separator:a1d6b35953984e8e7304068308e0eb3e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Locking class used as a context manager. </p>
<p>This class should be used in a <code>with</code> statement. It is instantiated with a filename of a file you wish to have exclusive access to for a limited time (default 10 seconds). Other processes, possibly even on different machines accessing the same network file system, will wait until either:</p><ul>
<li>the lock is removed</li>
<li>or the <code>lockduration</code> is exceeded</li>
</ul>
<p>Of course, this assumes all processes use this locking mechanism. No attempt is made to limit access to the file for processes not using this class.</p>
<p><b>Examples</b> </p>
<div class="fragment"><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> <a class="code" href="namespacemotsfinder_1_1lockfile.html">motsfinder.lockfile</a> <span class="keyword">import</span> LockFile</div><div class="line"></div><div class="line">with LockFile(<span class="stringliteral">&quot;some_file_name.npy&quot;</span>, verbosity=1):</div><div class="line">    <span class="comment"># Perform some task on the file, knowing that no one else will</span></div><div class="line">    <span class="comment"># access the file (provided they also use LockFile)</span></div><div class="line">    time.sleep(5)</div></div><!-- fragment --><p><b>Notes</b> </p>
<p>The idea is based on a comment in the GNU/Linux open(2) manpage and inspired by the <a href="https://gitlab.com/warsaw/flufl.lock">flufl.lock</a> locking module by Barry Warsaw, which has similar goals but many more features.</p>
<p>The idea is to have each process write a unique file. This should not fail even if performed on many nodes concurrently, since every process uses a randomized unique name. Acquiring a lock then consists of creating a hard link to this file with the name of the actual lock file. This will fail for all but one process in concurrent situations even across nodes on an NFS share (as is indicated by the manpage comment mentioned above). The processes that didn't get the lock then wait a few seconds and try again.</p>
<p>There is an expiration time stored as access/modified time of the lock file. This is <code>lockduration</code> seconds in the future. Once this time has expired, the lock will be removed as it is assumed the process that created that lock hangs, has crashed, lost connection to the NFS, etc. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ad2e9e52a76ef5007ffc0bc32248a94b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2e9e52a76ef5007ffc0bc32248a94b2">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def __init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lockduration</em> = <code>10</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>verbosity</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a lock object. </p>
<p>The actual lock is acquired once the <code>with</code> context is entered.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td>Filename to lock. This file may or may not exist. It will not be modified at all and is just used to signal the <em>intention</em> to coordinate access to this file. The actual lock file will be called <code>"{fname}.lock"</code>, where <code>{fname}</code> is the value provided here. This lock file should not exist (except when created by this class). </td></tr>
    <tr><td class="paramname">lockduration</td><td>Maximum time in seconds to guarantee the lock. The lock is removed before that time if the <code>with</code> statement is exited before. Default is <code>10</code>. </td></tr>
    <tr><td class="paramname">verbosity</td><td>How verbose to be. If <code>0</code>, be quiet in all cases (except when errors occur, of course). For <code>1</code>, only print something if acquiring the lock fails and we have to wait. For <code>2</code>, print more status infos like which files are used, when they are created and deleted, etc. Default is <code>0</code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a41a65d7030dd1006b177d0bc24e1a12b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41a65d7030dd1006b177d0bc24e1a12b">&#9670;&nbsp;</a></span>__del__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def __del__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called upon object destruction. </p>
<p>There is no guarantee this ever gets called. However, if it does get called, it is clear we don't want to keep any lock. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a404692262c90487a8013dbdd128cdd7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a404692262c90487a8013dbdd128cdd7f">&#9670;&nbsp;</a></span>__enter__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def __enter__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enter the <code>with</code> context and establish the lock. </p>

</div>
</div>
<a id="a1d4375d5b88ea11310dcd3bfb10ecb97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d4375d5b88ea11310dcd3bfb10ecb97">&#9670;&nbsp;</a></span>__exit__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def __exit__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>exc_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>exc_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>exc_tb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Exit the <code>with</code> context and remove the lock. </p>

</div>
</div>
<a id="a45c44377b922843390f16be4d2a81a26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45c44377b922843390f16be4d2a81a26">&#9670;&nbsp;</a></span>_break_foreign_lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _break_foreign_lock </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Break a lock of a different process. </p>
<p>This should be called when the lock has expired, though no check is made here to ensure it actually has expired. It will remove the lock file and also the unique file that this lock file pointed to (if possible). </p>

</div>
</div>
<a id="a968bd6c270043d685c627502321465bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a968bd6c270043d685c627502321465bb">&#9670;&nbsp;</a></span>_extend_expiration_time()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _extend_expiration_time </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the expiration time of the unique file to the future. </p>
<p>This also affects the lock file in case we currently have the lock. The optional parameter can be used to extend the expiration time of e.g. a foreign lock file. </p>

</div>
</div>
<a id="a434e1592e020b950702bec7b815a9517"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a434e1592e020b950702bec7b815a9517">&#9670;&nbsp;</a></span>_has_expired()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _has_expired </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the currently active lock has expired. </p>
<p>Returns <code>False</code> if there is no lock. This checks the actual lock file, i.e. it applies if we have the lock or a different process has it. </p>

</div>
</div>
<a id="a8a667d81392a5cc5501fbf762fdde895"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a667d81392a5cc5501fbf762fdde895">&#9670;&nbsp;</a></span>_is_valid_unique_fname()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _is_valid_unique_fname </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validate that the given filename is a valid "unique" file name. </p>
<p>We don't ever want to delete a file not managed by this class. We therefore check that the unique file name adheres to our naming convention by starting with the lock file name (without path) but being longer than that. This should remove any chance of accidental file deletion (unless someone actively tries to make us look bad). </p>

</div>
</div>
<a id="aa6a0568822c98af51b64cc0898780df6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6a0568822c98af51b64cc0898780df6">&#9670;&nbsp;</a></span>_lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _lock </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Acquire the lock. </p>
<p>This creates the unique file (if it doesn't exist) and then tries to create the second hard link. If unsuccessful, we wait a bit and try again until the "foreign" lock has expired or has been removed. </p>

</div>
</div>
<a id="aa67ebc9d41a679fa84373d4af6def7cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa67ebc9d41a679fa84373d4af6def7cf">&#9670;&nbsp;</a></span>_read_lockfile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _read_lockfile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the contents of the current lock file. </p>
<p>If there is no lock file, returns <code>None</code>. If we created the lock file, the contents equals the name (without path) of our unique file. </p>

</div>
</div>
<a id="a4362e9f882532c0c9c975ad98faf7c04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4362e9f882532c0c9c975ad98faf7c04">&#9670;&nbsp;</a></span>_remove_unique_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _remove_unique_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove our unique file. </p>
<p>This does nothing if there is no unique file. </p>

</div>
</div>
<a id="aa0cc25a5ef891d30ed0cb386db0aa73e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0cc25a5ef891d30ed0cb386db0aa73e">&#9670;&nbsp;</a></span>_unlink()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _unlink </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fault-tolerant file deletion. </p>
<p>Does nothing if the file does not exist. </p>

</div>
</div>
<a id="a306aed28634b9b3b76f34d6aff3044ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a306aed28634b9b3b76f34d6aff3044ef">&#9670;&nbsp;</a></span>_unlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def _unlock </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Release the lock (if any). </p>
<p>This will <em>not</em> fail if we currently don't have the lock, which may easily happen when a different process removes our lock after it has expired.</p>
<p>The unique file is removed in all cases. </p>

</div>
</div>
<a id="a1d548c8fa4d88f1f332f2eb6efe17593"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d548c8fa4d88f1f332f2eb6efe17593">&#9670;&nbsp;</a></span>is_locked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def is_locked </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find out if we currently have the lock. </p>
<p>The condition to have the lock is that our unique file and the lock file are two hard links to the same file. This is checked by making sure the hard link count of our unique file is 2 and that their contents are equal.</p>
<p>No check for expiration of the lock is done here. </p>

</div>
</div>
<a id="a67847eb889791fe0e423c3d3c85bae6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67847eb889791fe0e423c3d3c85bae6a">&#9670;&nbsp;</a></span>lockfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def lockfile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The file used as primary link target. </p>

</div>
</div>
<a id="a0ec94fef2a7020d648307bd8551a3dea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ec94fef2a7020d648307bd8551a3dea">&#9670;&nbsp;</a></span>uniquefile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def uniquefile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The unique file used as second link target. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>motsfinder/lockfile/lockfile.py</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemotsfinder.html">motsfinder</a></li><li class="navelem"><a class="el" href="namespacemotsfinder_1_1lockfile.html">lockfile</a></li><li class="navelem"><a class="el" href="namespacemotsfinder_1_1lockfile_1_1lockfile.html">lockfile</a></li><li class="navelem"><a class="el" href="classmotsfinder_1_1lockfile_1_1lockfile_1_1LockFile.html">LockFile</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
